<!DOCTYPE html>
<html>
<head>
    <title>Rifa Seu Miguel</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
    <style>
        :root {
            --espac: 4px;
        }
        body {
            background-color: #F6F8F7;
            align-items: center;
            text-align: center;
        }
        #titulo {
            text-align: center;
            padding: 10px;
        }
        #tabela {
            text-align: center;
            display: grid;
            grid-template-columns: repeat(10, minmax(70px, 1fr));
            gap: var(--espac);
            width: 100%;
        }
        .loader {
            margin: 20px;
            padding: 10px;
            display: inline-block;
            border: 10px solid #EAF0F6;
            border-radius: 50%;
            border-top: 10px solid #FF7A59;
            width: 100px;
            height: 100px;
            animation: spinner 4s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #base {
            align-items: center;
            text-align: center;
        }
        #info {
            align-items: center;
            text-align: center;
        }
        #rifa {
            background-color: white;
            align-items: center;
            text-align: center;
            border-style: solid;
            border-width: thin;
            width: fit-content;
            display: inline-block;
            margin: 10px;
            padding: 10px;
        }
    </style>
</head>
    <body>
        <div id="titulo">
            <span>Rifa para ajudar Miguel Rogério em um tratamento de saúde de alto custo.</span>
        </div>
        <div class="loader" id="loader"></div>
        <div id="info">
            <label>Nome do comprador:</label><br>
            <input type="text" id="nome" placeholder="Digite Seu Nome"/><br>
            <label>Telefone:</label><br>
            <input type="tel" id="telefone" placeholder="(00) 00000-0000" title="Digite um número de telefone válido: (00) 00000-0000"/><br>
            <label>Quantidade de rifas:</label><br>
            <select id="qtdrifas" name="qtdrifas">
                <option value=1>1</option>
                <option value=2>2</option>
                <option value=3>3</option>
                <option value=4>4</option>
                <option value=5>5</option>
                <option value=6>6</option>
                <option value=7>7</option>
                <option value=8>8</option>
                <option value=9>9</option>
                <option value=10>10</option>
            </select><br>
            <button id="btSend" class="btZap" onclick="enviarFormulario()">Gerar Rifa</button>
        </div>
        <div id="rifa">
            <span>Comprovante de Rifa</span><br><br>
            <span>Ação entre amigos para ajudar seu Miguel Rogério.</span><br>
            <span>[MMMMM], telefone: [TTTTT],</span><br>
            <span>comprou [CCCCC] rifas, no valor de R$ 10,00 cada.</span><br>
            <span>Nós envie esse comprovate para dar baixa do seu pagamento.</span><br>
            <span>Comprovante: [XXXXX]</span>
        </div>
        <div id="base">
            <span>Estamos dando continuidade a companha em forma de rifa,</span><br>
            <span>pois o valor tratamento é de R$ 130.000,00 e ainda falta muito.</span><br>
            <span>para a gente conseguir. Seguimos na luta!</span><br><br>
            <span>Serão feitos vários sorteios com os seguintes prêmios:</span><br>
            <span>Data do sorteio: 05/08/2023 sábado.</span><br>
            <span>1 - Argola de ouro 24k:<br>
                2 - ?????<br>
                3 - ?????<br>
                4 - ?????</span><br>
            <span>Agradecemos muito por sua contribuição!</span>
        </div>
    </body>
    <script>

        $(document).ready(function() {
            $("#telefone").inputmask("(99) 99999-9999");
            $('#loader').hide();
            $('#rifa').hide();
        });

        function stopLoad() {
            $('#rifa').show();
            $('#loader').hide();
        }

        function startLoad() {
            $('#info').hide();
            $('#loader').show();
        }

        function btZapClick() {
            var numeroTelefone = "5584988054083";
            var mensagem = "Quero comprar uma rifa para ajudar Seu Miguel Rogério."; 
            var mensagemCodificada = encodeURIComponent(mensagem);

            var linkWhatsApp = "https://api.whatsapp.com/send?phone=" + numeroTelefone + "&text=" + mensagemCodificada;

            window
            .location.href = linkWhatsApp;
        }

        function enviarFormulario() {
            var nome = document.getElementById("nome").value;
            var telefone = document.getElementById("telefone").value;
            var qtdrifas = document.getElementById("qtdrifas").value;

            var dados = [];

            for(var i = 0; i < qtdrifas; i++) {
                dados.push({
                    nome: nome,
                    telefone: telefone,
                });
            }

            url = 'https://script.google.com/macros/s/AKfycbwgmI-90Jgr55WuWIPX1GxZaPSV52AqOIAFodB6hNQyUzyH6xuBRwT8ixnDLD7F0XfY/exec'

            startLoad();

            fetch(url, {
                method: "POST",
                redirect: "follow",
                headers: {
                    "Content-Type": "text/plain;charset=utf-8"
                },
                body: JSON.stringify(dados)
            })
            .then(response => response.json())
            .then(data => {
                var divResposta = document.getElementById("rifa");
                var text = divResposta.innerHTML
                text = text.replace("[MMMMM]", nome);
                text = text.replace("[TTTTT]", telefone);
                text = text.replace("[CCCCC]", qtdrifas);
                divResposta.innerHTML = text.replace("[XXXXX]", data.codes.join(", "));
                stopLoad();
            })
            .catch(error => {
                console.error("Erro na solicitação:", error);
                stopLoad();
            });
        }
    </script>
</html>